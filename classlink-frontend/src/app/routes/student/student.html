<p-toast></p-toast>

<div class="student-page">
  <div class="soft-glow" aria-hidden="true"></div>

  <div *ngIf="apiError()" class="status status--error">{{ apiError() }}</div>

  <section class="card header-card">
    <div class="identity">
      <div class="avatar">{{ (currentStudent()?.name || 'S') | slice: 0 : 1 }}</div>
      <div>
        <h1>{{ currentStudent()?.name }}</h1>
        <p class="muted">{{ currentStudent()?.email }}</p>
      </div>
    </div>

    <div class="dicecup-logo">
      <div class="dicecup__logo" role="img" aria-label="DiceCup">
        <img class="dicecup-logo-icon" src="/assets/DiceCupLogoFinal.svg" alt="DiceCup" />
      </div>
    </div>

    <div class="headline-stats">
      <div class="stat-chip">
        <span class="icon pi pi-chart-scatter"></span>
        <div>
          <p class="label">Gesamt Note</p>
          <div class="value-row">
            <span class="value">{{ averageGrade() === null ? 'â€“' : (averageGrade() | number: '1.1-1') }}</span>
          </div>
        </div>
      </div>
      <div class="divider" aria-hidden="true"></div>
      <div class="stat-chip">
        <span class="icon pi pi-users"></span>
        <div>
          <p class="label">Laufende Projekte</p>
          <div class="value">{{ openProjects() }}</div>
        </div>
      </div>
    </div>
  </section>

  <div class="main-grid">
    <section class="card projects-card">
      <div class="section-header">
        <h2>Projekte</h2>
        <p class="eyebrow">Gruppenarbeiten</p>
      </div>

      <ng-container *ngIf="projects().length > 0; else noProjects">
        <div class="project-list">
          <article class="project-card" *ngFor="let project of projects(); trackBy: trackByProject">
            <div class="project-card__head">
              <div>
                <h3>{{ project.name }}</h3>
                <p class="muted">{{ project.status === 'done' ? 'Abgeschlossen' : 'Laufend' }}</p>
              </div>
              <div class="project-card__score">
                <ng-container *ngIf="project.scores as sc; else noScore">
                  <div class="score-pill">{{ sc.teacher }}</div>
                </ng-container>
                <ng-template #noScore>
                  <span class="muted">Noch keine Bewertung vorhanden.</span>
                </ng-template>
              </div>
            </div>

            <div class="project-card__actions">
              <p-button
                type="button"
                label="Bewertung"
                icon="pi pi-user"
                [severity]="project.status === 'done' ? 'success' : 'primary'"
              ></p-button>
            </div>
          </article>
        </div>
      </ng-container>
      <ng-template #noProjects>
        <div class="p-card-body">
          <h3>Du hast aktuell keine Projekte.</h3>
          <p>Dir sind derzeit keine Projekte zugeordnet.</p>
        </div>
      </ng-template>
    </section>
  </div>
</div>
