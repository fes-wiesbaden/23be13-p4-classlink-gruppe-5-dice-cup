<!-- Von Lukas bearbeitet; Template dem Student-Layout angeglichen -->
<p-toast></p-toast>
<div class="teacher-page">
  <section class="card header-card">
    <div class="identity">
      <div class="avatar">{{ teacherName | slice: 0 : 1 }}</div>
      <div>
        <h1 class="teacher-heading">{{ teacherName }}</h1>
        <div class="chips-row">
          <span class="chip chip--soft" *ngIf="teacherSubject">{{ teacherSubject }}</span>
          <span class="chip chip--outline" *ngIf="teacherRole">{{ teacherRole }}</span>
        </div>
      </div>
    </div>

    <div class="dicecup-logo">
      <div class="dicecup__logo" role="img" aria-label="DiceCup">
        <img class="dicecup-logo-icon" src="/assets/DiceCupLogoFinal.svg" alt="DiceCup" />
      </div>
    </div>
  </section>

<div class="card panel u-mt-2" *ngIf="apiError()">
  <div class="p-card-body u-text-danger">
    {{ apiError() }}
  </div>
</div>

<teacher-student-sidebar
  [students]="filteredStudents()"
  [selectedStudentId]="selectedStudentId()"
  [search]="search()"
  [classes]="classes()"
  [selectedClass]="selectedClassId()"
  [assignClassName]="assignClassName()"
  (selectStudent)="onSelectStudent($event)"
  (searchChange)="onSearchChange($event)"
  (classChange)="onClassChange($event)"
  (createClass)="onCreateClass()"
  (assignClassChange)="assignClassName.set($event)"
  (assignSelected)="onAssignSelectedToClass()"
/>

<div class="card panel u-mt-4" *ngIf="classes().length === 0">
  <div class="p-card-body">
    <h3>Dir sind noch keine Klassen zugewiesen.</h3>
  </div>
</div>

<div class="card panel u-mt-4" *ngIf="classes().length > 0 && !selectedClassId()">
  <div class="p-card-body">
    <h3>Bitte Klasse auswählen</h3>
    <p>Wähle eine Klasse, um Schüler und Projekte zu laden.</p>
  </div>
</div>

<div class="card panel u-mt-4" *ngIf="selectedClassId() && students().length === 0">
  <div class="p-card-body">
    <h3>Keine Schüler verfügbar</h3>
    <p *ngIf="!selectedStudentId()">Wähle eine Klasse oder lade den Kontext neu.</p>
    <p *ngIf="students().length === 0">Für diese Klasse wurden keine Schüler gefunden.</p>
  </div>
</div>

<main class="content" *ngIf="selectedStudentId() as sid">
  <teacher-header-bar
    [student]="selectedStudentView()"
    [average]="overallAverage()"
    [trend]="null"
    (createProject)="onCreateProject()"
  />

  <ng-container *ngIf="scoreSummary(); else noScores">
    <teacher-kpi-cards [scores]="scoreSummary()!" />
  </ng-container>
  <ng-template #noScores>
    <div class="card panel u-mt-2">
      <div class="p-card-body">
        Für diesen Schüler/dieses Projekt liegen noch keine Bewertungen vor.
      </div>
    </div>
  </ng-template>

  <section class="card projects-card">
    <ng-container *ngIf="projects().length > 0; else noProjects">
      <teacher-project-assignment
        class="assign modern"
        [projectName]="currentProjectName() || ''"
        [students]="filteredStudents()"
        [assignedIds]="assignedIds()"
        [projectOptions]="projectOptions()"
        [projectId]="selectedProjectId() || ''"
        (projectChange)="onProjectChange($any($event))"
        (studentToggle)="onToggleAssignment($event)"
        (createProject)="onCreateProject()"
      />
    </ng-container>
    <ng-template #noProjects>
      <div class="p-card-body">
        <h3>Für diese Klasse gibt es noch keine Projekte.</h3>
        <p *ngIf="!selectedClassId()">Bitte zuerst eine Klasse auswählen.</p>
      </div>
    </ng-template>
  </section>
</main>
</div>
