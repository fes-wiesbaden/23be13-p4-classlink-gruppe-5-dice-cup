<p-toast></p-toast>

<div class="student-page">
  <div class="page-decor" aria-hidden="true">
    <span class="orb orb--a"></span>
    <span class="orb orb--b"></span>
    <span class="orb orb--c"></span>
  </div>

  <section class="panel hero">
    <div class="hero__left">
      <div class="avatar">{{ studentName | slice: 0 : 1 }}</div>
      <div>
        <p class="eyebrow">Dashboard</p>
        <h1>{{ studentName }}</h1>
      </div>
    </div>
    <div class="hero__stats">
      <div class="stat-pill">
        <span>Ø Gesamt</span>
        <strong>{{ averageGrade | number: '1.1-1' }}</strong>
      </div>
      <div class="stat-pill">
        <span>Offene Projekte</span>
        <strong>{{ projects.length }}</strong>
      </div>
    </div>
  </section>

  <section class="panel grades">
    <div class="panel__header">
      <div>
        <h2>Notenuebersicht</h2>
      </div>
    </div>

    <div class="lf-scroll">
      <button
        class="lf-tile"
        type="button"
        *ngFor="let lf of lernfelder; trackBy: trackByLernfeld"
        (click)="selectLernfeld(lf)"
        [class.lf-tile--active]="isSelected(lf.id)"
      >
        <span class="lf-chip">LF {{ lf.id }}</span>
        <div class="lf-title">{{ lf.focus }}</div>

        <div class="lf-meta">
          <span class="lf-grade" [style.backgroundColor]="gradeColor(lf.average)"
            >Ø {{ lf.average | number: '1.1-1' }}</span
          >
          <span class="lf-trend">{{ lf.trend }}</span>
        </div>
      </button>
    </div>

    <div class="lf-detail" *ngIf="selectedLernfeld as sel">
      <div class="lf-detail__head">
        <div>
          <p class="eyebrow">Details</p>
          <h3>{{ sel.title }}</h3>
          <p class="muted">{{ sel.focus }}</p>
        </div>
        <div class="lf-detail__avg" [style.backgroundColor]="gradeColor(sel.average)">
          <span>Ø</span>
          <strong>{{ sel.average | number: '1.1-1' }}</strong>
          <small>{{ sel.trend }}</small>
        </div>
      </div>
      <div class="lf-detail__assessments">
        <div class="assessment" *ngFor="let g of sel.assessments">
          <div>
            <div class="assessment__label">{{ g.label }}</div>
            <div class="assessment__meta">
              {{ g.type }} · {{ g.weight * 100 | number: '1.0-0' }}%
            </div>
          </div>
          <div class="assessment__grade" [style.backgroundColor]="gradeColor(g.grade)">
            {{ g.grade | number: '1.1-1' }}
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="panel projects">
    <div class="panel__header">
      <div>
        <p class="eyebrow">Projekte</p>
        <h2>Teamarbeiten & Abgaben</h2>
      </div>
    </div>
    <div class="project-grid">
      <article class="project-card" *ngFor="let project of projects; trackBy: trackByProject">
        <div class="project-card__head">
          <div>
            <div class="chip">Projekt</div>
            <h3>{{ project.name }}</h3>
            <p class="muted">{{ project.role }} · Fällig {{ project.nextDue }}</p>
          </div>
          <div class="project-card__score">
            <div>
              <span>Lehrer</span>
              <strong>{{ project.scores.teacher }}</strong>
            </div>
            <div>
              <span>Peer</span>
              <strong>{{ project.scores.peer }}</strong>
            </div>
          </div>
        </div>
        <div class="project-card__meter">
          <div class="meter__track">
            <div
              class="meter__fill"
              [style.width]="project.progress + '%'"
              [style.background]="project.color"
            ></div>
          </div>
          <span>{{ project.progress }}% Fortschritt</span>
        </div>
        <div class="project-card__actions">
          <p-button
            type="button"
            label="Selbst-Evaluation"
            icon="pi pi-user"
            [severity]="project.selfDone ? 'success' : 'secondary'"
            styleClass="ghost"
            (onClick)="startSelfEvaluation(project)"
          ></p-button>
          <p-button
            type="button"
            label="Peer-Evaluation"
            icon="pi pi-users"
            [severity]="project.peerDone ? 'success' : 'primary'"
            (onClick)="startPeerEvaluation(project)"
          ></p-button>
        </div>
      </article>
    </div>
  </section>
</div>
