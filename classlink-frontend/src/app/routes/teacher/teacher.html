<!-- Von Lukas bearbeitet -->
<p-toast></p-toast>
<div class="teacher-page">
  <teacher-student-sidebar
    [students]="filteredStudents"
    [selectedStudentId]="selectedStudentId"
    [search]="search"
    [classes]="classes"
    [selectedClass]="selectedClass"
    [assignClassName]="assignClassName"
    (selectStudent)="onSelectStudent($event)"
    (searchChange)="onSearchChange($event)"
    (classChange)="onClassChange($event)"
    (createClass)="onCreateClass()"
    (assignClassChange)="assignClassName = $event"
    (assignSelected)="onAssignSelectedToClass()"
  />

  <main class="content" *ngIf="selectedStudent as st">
    <teacher-header-bar
      [student]="st"
      (createProject)="onCreateProject()"
    />

    <p-dialog
      header="Neue Klasse anlegen"
      [(visible)]="showCreateClass"
      [modal]="true"
      [style]="{ width: '400px' }"
    >
      <div style="display:flex; flex-direction: column; gap: 12px;">
        <label for="newClassInput" class="section-title">Klassenname</label>
        <input
          id="newClassInput"
          pInputText
          type="text"
          placeholder="z. B. 10D"
          [(ngModel)]="newClassName"
        />
        <small class="muted" *ngIf="!newClassName.trim()">Pflichtfeld</small>
        <small class="muted" *ngIf="newClassName.trim() && classes.includes(newClassName.trim())">Klasse existiert bereits</small>
        <div style="display:flex; justify-content:flex-end; gap: 8px; margin-top: 8px;">
          <button type="button" class="btn" (click)="cancelCreateClass()">Abbrechen</button>
          <button type="button" class="btn-accent" [disabled]="!isNewClassValid" (click)="confirmCreateClass()">
            <i class="pi pi-check"></i>&nbsp;Erstellen
          </button>
        </div>
      </div>
    </p-dialog>

    <teacher-kpi-cards *ngIf="scoreSummary as sc" [scores]="sc" [allowTeacherEdit]="true" />

    <section class="grid">
      <teacher-note-form
        [studentName]="st.name"
        [(text)]="noteText"
        (send)="onSendNote()"
      />

      <teacher-project-assignment
        class="panel assign"
        [projectName]="currentProjectName || ''"
        [students]="students"
        [assignedIds]="assignedIds"
        [projectOptions]="projectOptions"
        [projectId]="selectedProjectId"
        (projectChange)="onProjectChange($any($event))"
        (toggle)="onToggleAssignment($event)"
      />
    </section>
  </main>
</div>
